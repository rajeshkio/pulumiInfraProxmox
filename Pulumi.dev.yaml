config:
  proxmoxInfra:gateway: 192.168.90.1
  proxmoxInfra:vmCreation:
    maxRetries: 5 # Retry attempts per VM (default: 5)
  # ========================================
  # INFRASTRUCTURE LAYER - Virtual Machines
  # ========================================
  # Define your VMs - pure infrastructure, no services attached yet

  proxmoxInfra:lb-vm-template: &lb-vm
    count: 1
    templateId: 9000
    cpu: 2
    memory: 2000
    diskSize: 50
    username: rajeshk
    authMethod: ssh-key
    proxmoxNode: proxmox-2
    bootMethod: cloud-init
  proxmoxInfra:k8s-cp-template: &k8s-cp
    count: 3
    templateId: 9001 # SLE Micro template
    cpu: 4
    memory: 4000
    diskSize: 50
    username: rajeshk
    authMethod: ssh-key
    proxmoxNode: proxmox-2
    bootMethod: cloud-init
  proxmoxInfra:k8s-api-port: &k8s-api
    name: "api"
    frontend: 6443
    backend: 6443
  proxmoxInfra:rke2-supervisor-port: &rke2-supervisor
    name: "supervisor"
    frontend: 9345
    backend: 9345

  proxmoxInfra:k8s-worker-template: &k8s-worker
    count: 2
    templateId: 9001 # SLE Micro template
    cpu: 4
    memory: 8000
    diskSize: 50
    username: rajeshk
    authMethod: ssh-key
    proxmoxNode: proxmox-2
    bootMethod: cloud-init

  proxmoxInfra:vms:
    # K3s Infrastructure
    - <<: *lb-vm
      name: "k3s-lb"
      ips: ["192.168.90.200"]

    - <<: *k8s-cp
      name: "k3s-servers"
      ips: ["192.168.90.180", "192.168.90.181", "192.168.90.182"]

    - <<: *k8s-worker
      name: "k3s-workers"
      count: 0 # Disabled by default, enable when needed
      ips: ["192.168.90.190", "192.168.90.191"]

    # RKE2 Infrastructure
    - <<: *lb-vm
      name: "rke2-lb"
      ips: ["192.168.90.201"]
      templateId: 9002

    - <<: *k8s-cp
      name: "rke2-servers"
      ips: ["192.168.90.210", "192.168.90.211", "192.168.90.212"]
      templateId: 9001

    - <<: *k8s-worker
      name: "rke2-workers"
      count: 0 # Disabled by default, enable when needed
      ips: ["192.168.90.220", "192.168.90.221"]
      templateId: 9000

    # Kubeadm Infrastructure
    - <<: *lb-vm
      name: "kubeadm-lb"
      count: 0
      ips: ["192.168.90.202"]

    - <<: *k8s-cp
      name: "kubeadm-servers"
      count: 0
      templateId: 9000 # Override template (Ubuntu not SLE Micro)
      ips: ["192.168.90.230", "192.168.90.231", "192.168.90.232"]

    - <<: *k8s-worker
      name: "kubeadm-workers"
      count: 0
      templateId: 9000
      ips: ["192.168.90.240", "192.168.90.241"]

    # Harvester
    - name: "harvester-nodes"
      count: 3
      bootMethod: "ipxe"
      ipxeConfig:
        isoFiles:
          - "harvester-create-v1.4.3.iso"
          - "harvester-join-v1.4.3.iso"
      memory: 40000
      cpu: 12
      diskSize: 300
  # ========================================
  # SERVICES LAYER - What runs on those VMs
  # ========================================
  # Enable only what you need - services discover their target VMs
  proxmoxInfra:services:
    k3s:
      enabled: true
      loadBalancer: ["k3s-lb"]
      controlPlane: ["k3s-servers"]
      workers: ["k3s-workers"]
      config:
        cluster-init: true
        tls-san-loadbalancer: true
        ports:
          - backend: 6443
            frontend: 6443
            name: api
    rke2:
      enabled: true
      loadBalancer: ["rke2-lb"]
      controlPlane: ["rke2-servers"]
      workers: ["rke2-workers"]
      config:
        cluster-init: true
        ports:
          - backend: 6443
            frontend: 6443
            name: api
          - backend: 9345
            frontend: 9345
            name: supervisor
    # Kubeadm (not yet implemented)
    kubeadm:
      enabled: false
      loadBalancer: ["kubeadm-lb"]
      controlPlane: ["kubeadm-servers"]
      workers: []
      config:
        pod-cidr: "10.244.0.0/16"
        service-cidr: "10.96.0.0/12"
    # Talos Linux (not yet implemented)
    talos:
      enabled: false
      targets: ["kubeadm-servers", "workers"]
  proxmoxInfra:password:
    secure: AAABAIMIdAA1OOB5sH3ekJTNS/LXRh09+WqrmcCWiqSd/piWShM3ow==
